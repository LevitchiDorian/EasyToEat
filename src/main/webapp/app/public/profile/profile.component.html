<div class="rv-profile-page">
  <!-- Background blobs -->
  <div class="rv-profile-blob rv-profile-blob--1"></div>
  <div class="rv-profile-blob rv-profile-blob--2"></div>

  <div class="rv-profile-container animate-fade-in">
    <!-- Back link -->
    <a class="rv-profile-back" routerLink="/">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M19 12H5M5 12l7 7M5 12l7-7" />
      </svg>
      Înapoi acasă
    </a>

    <h1 class="rv-profile-title">Profilul meu</h1>

    @if (account()) {
      <!-- ── AVATAR CARD ─────────────────────────────────────────── -->
      <div class="glass rv-card animate-fade-in animate-delay-1">
        <div class="rv-avatar-row">
          <div class="rv-avatar">
            @if (account()?.imageUrl) {
              <img [src]="account()!.imageUrl" alt="Avatar" class="rv-avatar__img" />
            } @else {
              <span class="rv-avatar__initials">{{ getInitials() }}</span>
            }
          </div>
          <div class="rv-avatar-info">
            <p class="rv-avatar-name">
              {{ account()?.firstName ? account()!.firstName + ' ' + (account()!.lastName ?? '') : account()?.login }}
            </p>
            <p class="rv-avatar-email">{{ account()?.email }}</p>
            <span class="rv-badge">{{ account()?.authorities?.includes('ROLE_ADMIN') ? 'Administrator' : 'Utilizator' }}</span>
          </div>
        </div>
      </div>

      <!-- ── SUCCESS / ERROR ALERTS ─────────────────────────────── -->
      @if (success()) {
        <div class="rv-alert rv-alert--success animate-fade-in">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="20 6 9 17 4 12" />
          </svg>
          Profilul a fost actualizat cu succes.
        </div>
      }
      @if (error()) {
        <div class="rv-alert rv-alert--error animate-fade-in">A apărut o eroare la salvare. Încearcă din nou.</div>
      }

      <!-- ── PERSONAL INFO CARD ──────────────────────────────────── -->
      <div class="glass rv-card animate-fade-in animate-delay-2">
        <div class="rv-card__header">
          <div class="rv-card__header-left">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <h3 class="rv-card__title">Informații personale</h3>
          </div>
          @if (!isEditing()) {
            <button class="rv-btn rv-btn--ghost" (click)="startEditing()">Editează</button>
          } @else {
            <div class="rv-card__actions">
              <button class="rv-btn rv-btn--ghost" (click)="cancelEditing()" [disabled]="isSaving()">Anulează</button>
              <button class="rv-btn rv-btn--primary" (click)="save()" [disabled]="profileForm.invalid || isSaving()">
                @if (isSaving()) {
                  <span class="rv-spinner"></span> Se salvează…
                } @else {
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  Salvează
                }
              </button>
            </div>
          }
        </div>

        <div class="rv-fields" [formGroup]="profileForm">
          <!-- First name -->
          <div class="rv-field">
            <label class="rv-field__label">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
              Prenume
            </label>
            @if (isEditing()) {
              <input class="rv-field__input" type="text" formControlName="firstName" placeholder="Prenumele tău" />
            } @else {
              <p class="rv-field__value">{{ account()?.firstName || '—' }}</p>
            }
          </div>

          <!-- Last name -->
          <div class="rv-field">
            <label class="rv-field__label">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
              Nume de familie
            </label>
            @if (isEditing()) {
              <input class="rv-field__input" type="text" formControlName="lastName" placeholder="Numele de familie" />
            } @else {
              <p class="rv-field__value">{{ account()?.lastName || '—' }}</p>
            }
          </div>

          <!-- Email -->
          <div class="rv-field">
            <label class="rv-field__label">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                <polyline points="22,6 12,13 2,6" />
              </svg>
              Email
            </label>
            @if (isEditing()) {
              <input class="rv-field__input" type="email" formControlName="email" placeholder="email@exemplu.md" />
            } @else {
              <p class="rv-field__value">{{ account()?.email }}</p>
            }
          </div>

          <!-- Username (readonly) -->
          <div class="rv-field">
            <label class="rv-field__label">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
              Utilizator
            </label>
            <p class="rv-field__value rv-field__value--muted">{{ account()?.login }}</p>
          </div>
        </div>
      </div>

      <!-- ── SECURITY CARD ───────────────────────────────────────── -->
      <div class="glass rv-card animate-fade-in animate-delay-3">
        <div class="rv-card__header">
          <div class="rv-card__header-left">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
            <h3 class="rv-card__title">Securitate</h3>
          </div>
        </div>
        <p class="rv-security-desc">Schimbă parola contului tău pentru a-l proteja.</p>
        <a class="rv-btn rv-btn--outline" routerLink="/account/password">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
          Schimbă parola
        </a>
      </div>
    } @else {
      <!-- Loading skeleton -->
      <div class="rv-skeleton-card glass rv-card"></div>
      <div class="rv-skeleton-card glass rv-card rv-skeleton-card--tall"></div>
    }
  </div>
</div>
